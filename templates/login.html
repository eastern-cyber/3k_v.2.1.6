<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KokKokKok - Login</title>
    <link rel="shortcut icon" type="image/x-icon" href="../static/images/favicon.ico" >
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
        [x-cloak] {
            display: none !important; 
        }
        body {
            @apply font-light
        }
        h1 {
            @apply text-[2rem] font-bold
        }
        .input-field {
            @apply bg-neutral-100 w-full px-3 py-2.5 border border-neutral-300 rounded-sm placeholder-neutral-400 focus:border-neutral-400 focus:outline-hidden 
        }
        .button {
            @apply bg-neutral-100 w-full px-3 py-2.5 rounded-sm font-medium text-neutral-400 select-none
        }
        .button-active {
            @apply bg-rose-500 hover:bg-rose-600 text-white cursor-pointer
        }
    </style>
</head>
<body>
    <div class="min-h-[100dvh] grid grid-rows-[auto_1fr_auto]">
        <header class="sticky top-0 z-10">
            <div class="bg-white h-[60px] flex items-center px-2.5">
                <a href="/templates/">
                    <img src="../static/images/3k_v.2.1.2.png">
                </a>
            </div>
        </header>

        <main>
            <div class="max-w-[360px] mx-auto pt-16">
                <h1 class="text-center pb-4">Login</h1>
                <div class="mb-10">
                    <!-- MODIFIED FORM START -->
                    <form x-data="{ email: '', password: '', loading: false, error: '' }" 
                          @submit.prevent="handleSubmit" 
                          id="loginForm">
                        <p class="font-medium text-sm mb-1">Email or Username</p>
                        <div class="flex flex-col gap-2 mb-2">
                            <input x-model="email" 
                                   name="email" 
                                   type="text" 
                                   placeholder="Email or Username" 
                                   class="input-field" 
                                   :disabled="loading"
                                   required>
                            
                            <div x-data="{ password_show: false }" class="grid relative w-full">
                                <input x-model="password" 
                                       name="password" 
                                       :type="password_show ? 'text' : 'password'" 
                                       placeholder="Password" 
                                       class="input-field" 
                                       :disabled="loading"
                                       required>
                                <a @click="password_show = !password_show" class="h-5 w-5 absolute top-3 right-3.5 fill-neutral-500 cursor-pointer">
                                    <svg x-show="!password_show" viewBox="0 0 48 48">
                                        <!-- Keep existing SVG code -->
                                    </svg>
                                    <svg x-show="password_show" x-cloak viewBox="0 0 48 48">
                                        <!-- Keep existing SVG code -->
                                    </svg>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Error message display -->
                        <div x-show="error" x-cloak class="text-red-500 text-sm mb-4">
                            <span x-text="error"></span>
                        </div>
                        
                        <a href="/templates/forgot-password.html" class="inline-block align-top text-xs font-medium text-neutral-500 hover:underline hover:text-black mb-6">
                            Forgot password?
                        </a>
                        
                        <button type="submit" 
                                class="button flex items-center justify-center gap-2"
                                :class="{ 'button-active': email && password, 'opacity-70 cursor-not-allowed': loading }"
                                :disabled="loading || !email || !password">
                            <svg x-show="loading" class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span x-text="loading ? 'Logging in...' : 'Login'"></span>
                        </button>
                    </form>
                    <!-- MODIFIED FORM END -->
                </div>
                
                <div class="p-0 flex justify-center font-bold">
                    <p class="p-4 rounded-sm bg-neutral-200 mb-6 hover:bg-red-500">
                    <a href="home.html" class="font-medium hover:bg-red-500 text-neutral-600 hover:text-neutral-100 mb-6">
                        App Prototype
                    </a>
                    </p>
                </div>
                
                <div class="flex justify-center">
                    <a href="index.html" class="flex items-center">
                        <div class="w-3.5 h-3.5">
                            <svg viewBox="0 0 48 48">
                                <path d="M4.58579 22.5858L20.8787 6.29289C21.2692 5.90237 21.9024 5.90237 22.2929 6.29289L23.7071 7.70711C24.0976 8.09763 24.0976 8.7308 23.7071 9.12132L8.82843 24L23.7071 38.8787C24.0976 39.2692 24.0976 39.9024 23.7071 40.2929L22.2929 41.7071C21.9024 42.0976 21.2692 42.0976 20.8787 41.7071L4.58579 25.4142C3.80474 24.6332 3.80474 23.3668 4.58579 22.5858Z"></path>
                            </svg>
                        </div>
                        <p class="font-medium">Back to Home</p>
                    </a>
                </div>
            </div>
        </main>

        <footer>
            <div class="text-center p-5 border-t border-neutral-300">
                <p>No account yet? <a href="/templates/signup.html" class="text-rose-500 font-medium hover:underline">Register</a></p>
            </div>
            <div class="bg-black text-neutral-400 h-21 flex items-center justify-end px-36 text-sm">
                <p>Â© 2025 KokKokKok</p>
            </div>
        </footer>
    </div>
    
    <script>
    // Add the handleSubmit function to Alpine.js global scope
    document.addEventListener('alpine:init', () => {
        Alpine.data('loginForm', () => ({
            email: '',
            password: '',
            loading: false,
            error: '',
            
            handleSubmit() {
                this.loading = true;
                this.error = '';
                
                fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: this.email,
                        password: this.password
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        localStorage.setItem('user_token', data.token);
                        localStorage.setItem('user_data', JSON.stringify(data.user));
                        window.location.href = '/templates/home.html';
                    } else {
                        this.error = data.message || 'Invalid email or password';
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    this.error = 'Connection error. Please try again.';
                })
                .finally(() => {
                    this.loading = false;
                });
            }
        }));
    });
    </script>
</body>
</html>